<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تحميل الفيديو</title>
    <script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>تحميل الفيديو</h1>
    <form id="videoForm">
        <label for="url">رابط الفيديو:</label>
        <input type="text" id="url" name="url" required><br><br>
        <button type="submit">تحميل الفيديو</button>
    </form>

    <div id="status"></div>

    <script>
        var socket = io('http://127.0.0.1:5001');

        // استماع لحالة التحميل من السيرفر
        socket.on('download_status', function(data) {
            $('#status').html(data.status); // تحديث حالة التحميل
            if (data.filename) {
                // تنزيل الفيديو مباشرة بعد اكتمال التحميل
                var downloadLink = '/download_file/' + data.filename;
                window.location.href = downloadLink; // هذا يقوم بتحميل الفيديو مباشرة
            }
        });

        // عند إرسال النموذج
        $('#videoForm').submit(function(e) {
            e.preventDefault();
            var url = $('#url').val();

            // إرسال الطلب إلى السيرفر عبر AJAX
            $.ajax({
                url: '/download',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({url: url}),
                success: function(response) {
                    console.log('تم إرسال الطلب');
                }
            });
        });
    </script>
</body>
</html>
